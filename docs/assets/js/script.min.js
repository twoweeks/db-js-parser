"use strict";let parseLocalComps=e=>{let t=$make.qs(".names"),a=$create.elem("ul");e.forEach(e=>{let t=$create.elem("li"),m=$create.elem("button",e.name,"btn btn__name");if(e.altNames&&0!=e.altNames.length){let t=$create.elem("ul","","btn__name--alt-names-list");e.altNames.forEach(e=>{let a=$create.elem("li",e);t.appendChild(a)}),m.appendChild(t)}m.addEventListener("click",t=>{getCompData(e.file)}),t.appendChild(m),a.appendChild(t)}),t.appendChild(a)},parseGame=e=>{let t=$create.elem("div","","comp_games--game _game");if(!e)return;let a=e.game,m=e.CDN;if(a.image&&""!=a.image){let e=$create.elem("div","","_game__image"),l=($create.elem("picture"),$create.elem("img"));l.dataset.src=`${m.imgs}/${a.image}`,e.appendChild(l),t.appendChild(e)}else t.classList.add("_game--no-image");let l=$create.elem("div","","_game__info");return t.appendChild(l),t};$create.db={icon:e=>`<i class="material-icons">${e}</i>`,textBlocks:e=>`<span>${e.replace(/\n/g,"</span><span>")}</span>`,time:e=>{return new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(1e3*e))}};let getCompData=e=>{e||(e="twg");let t={data:"https://raw.githubusercontent.com/twoweeks/db/master/json/min",imgs:"https://gd-imgs.cojam.ru"},a=$make.qs(".comps-list"),m=$make.qs(".comps");fetch(`${t.data}/${e}.json`).then(e=>{if(e.ok)return a.textContent="",m.textContent="",e.json();throw 42}).then(e=>{let l=$create.elem("ul");e.forEach(e=>{let a=$create.elem("li"),i=$create.elem("button",`Конкурс №${e.meta.num}`,"btn btn__comp"),n=!(!e.meta.edition||""==e.meta.edition);a.appendChild(i),l.appendChild(a);let d=$create.elem("div","","comp");d.dataset.num=e.meta.num;let p=$create.elem("div","","comp__header"),s=$create.elem("div","","comp__games"),c=$create.elem("h2",`<span>Конкурс №${e.meta.num}</span>`,"comp__header--title");if(e.site&&""!=e.site){let t=$create.link(e.site,$create.db.icon("home"),"",["e"]);t.setAttribute("title","Сайт конкурса"),c.appendChild(t)}if(n){let t=$create.elem("small",`${e.meta.edition} Edition`);c.appendChild(t)}if(p.appendChild(c),e.themes&&0!=e.themes.length){let t=$create.elem("ul","","comp__header--themes");e.themes.forEach(e=>{let a=$create.elem("li");a.appendChild($create.elem("p",`${$create.db.icon("label")} <span>${e.name}</span>`)),e.description&&a.appendChild($create.elem("p",$create.db.textBlocks(e.description))),t.appendChild(a)}),p.appendChild(t)}if(e.note&&""!=e.note){let t=$create.elem("div",$create.elem("p",`Примечание: ${$create.db.textBlocks(e.note)}`,"",["html"]),"comp__header--note");p.appendChild(t)}if(e.achievements&&""!=e.achievements){let t=$create.elem("details",'<summary class="btn btn--nfw"></summary>',"comp__header--ach"),a=$create.elem("ul");e.achievements.forEach(e=>{let t=$create.elem("li");t.appendChild($create.elem("p",`${$create.db.icon("star")} <span>${e.name}</span>`)),e.description&&t.appendChild($create.elem("p",$create.db.textBlocks(e.description))),a.appendChild(t)}),t.appendChild(a),p.appendChild(t)}if(e.fund&&""!=e.fund){let t=$create.elem("div",$create.elem("p",`Призовой фонд: ${e.fund}`,"",["html"]),"comp__header--fund");p.appendChild(t)}if(e.dates){let t=$create.elem("div","","comp__header--dates");e.dates.start&&t.appendChild($create.elem("p",`Начало конкурса: ${$create.db.time(e.dates.start)}`)),e.dates.end&&t.appendChild($create.elem("p",`Конец конкурса: ${$create.db.time(e.dates.end)}`)),p.appendChild(t)}if(d.appendChild(p),e.games&&0!=e.games.length&&e.games.forEach((a,m)=>{if("disqualified"==a.status&&m+2<e.games.length)return void e.games.push(a);let l=parseGame({game:a,CDN:t});s.appendChild(l)}),d.appendChild(s),m.appendChild(d),n){d.dataset.edition=e.meta.edition;let t=$create.elem("p",`${e.meta.edition} Edition`,"btn__comp--edition");i.appendChild(t)}i.addEventListener("click",t=>{$make.qs(`.comps .comp[data-num='${e.meta.num}']${n?"[data-edition="+e.meta.edition+"]":""}`).scrollIntoView({behavior:"smooth",block:"start",inline:"start"})})}),a.appendChild(l),new LazyLoad({elements_selector:"._game__image img"})}).catch(e=>{console.log(e)})};document.addEventListener("DOMContentLoaded",()=>{parseLocalComps([{name:"Two Weeks Game",file:"twg"},{name:"Two-Two Weeks Game",file:"ttwg"},{name:"One Week Game",altNames:["Two/Two Weeks Game"],file:"owg"},{name:"Three Days Game",file:"three-dg"},{name:"Two Days Game",file:"two-dg"}]);let e=$check.get("get")||"twg";getCompData(e)});
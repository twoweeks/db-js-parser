"use strict";let parseLocalComps=e=>{let t=$make.qs(".names"),a=$create.elem("ul");e.forEach(e=>{let t=$create.elem("li"),i=$create.elem("button",e.name,"btn btn__name");if(e.altNames&&0!=e.altNames.length){let t=$create.elem("ul","","btn__name--alt-names-list");e.altNames.forEach(e=>{let a=$create.elem("li",e);t.appendChild(a)}),i.appendChild(t)}i.addEventListener("click",t=>{getCompData(e.file)}),t.appendChild(i),a.appendChild(t)}),t.appendChild(a)},parseGame=e=>{let t=$create.elem("div","","comp_games--game _game");if(!e)return;let a=e.game,i=e.CDN;if(a.image&&""!=a.image){let e=$create.elem("div","","_game__image"),d=($create.elem("picture"),$create.elem("img"));d.setAttribute("src",`${i.imgs}/${a.image}`),e.appendChild(d),t.appendChild(e)}else t.classList.add("_game--no-image");let d=$create.elem("div","","_game__info"),n=$create.elem("h2",$create.db.icon("videogame_asset"),"_game__info--name _middle");n.appendChild($create.elem("span",a.name&&""!=a.name?a.name:"Названия нет")),d.appendChild(n),a.genre&&""!=a.genre&&d.appendChild($create.elem("p",`Жанр: ${a.genre}`)),d.appendChild($create.elem("div",a.description?$create.db.textBlocks(a.description):"Описания нет.","_game__info--description")),a.tools&&""!=a.tools&&d.appendChild($create.elem("p",`Инструменты: ${a.tools}`)),a.dependencies&&""!=a.dependencies&&d.appendChild($create.elem("p",`Зависимости: ${a.dependencies}`)),a.note&&""!=a.note&&d.appendChild($create.elem("p",`Примечание: ${a.note}`));let l="";switch(a.status){case"win":case"1":l="Победитель";break;case"2":case"3":case"4":l=`${a.status} место`;break;case"final":l="Финалист";break;case"demo":l="Демоверсия";break;case"updated":l="Обновлённая версия";break;case"disqualified":l="Дисквалификация";break;default:console.info(`Неизвестный статус ${a.status} у ${a.name}`)}let m=$create.elem("div",$create.db.icon("disqualified"!=a.status?"star":"close"),`_game__info--status _status _status--${a.status&&""!=a.status?a.status:"empty"}`);return m.firstChild.setAttribute("title",l),d.appendChild(m),t.appendChild(d),t};$create.db={icon:e=>`<i class="material-icons">${e}</i>`,textBlocks:e=>`<span class="_tb">${e.replace(/\n/g,'</span><span class="_tb">')}</span>`,time:e=>{return new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(1e3*e))}};let getCompData=e=>{e||(e="twg");let t={data:"https://raw.githubusercontent.com/twoweeks/db/master/json/min",imgs:"https://gd-imgs.cojam.ru"},a=$make.qs(".comps-list"),i=$make.qs(".comps"),d=e=>{[...$make.qsf("button.btn__comp",a,["a"]),...$make.qsf(".comp",i,["a"])].forEach(t=>{let a=t.dataset;"selected"in a&&delete a.selected,"edition"in e?a.num==e.num&&a.edition==e.edition&&(a.selected=""):a.num==e.num&&(a.selected="")})};fetch(`${t.data}/${e}.json`).then(e=>{if(e.ok)return a.textContent="",i.textContent="",e.json();throw 42}).then(e=>{let n=$create.elem("ul");e.forEach((e,a)=>{let l=$create.elem("li"),m=$create.elem("button","","btn btn__comp");m.appendChild($create.elem("span",`Конкурс №${e.meta.num}`));let s=!(!e.meta.edition||""==e.meta.edition);l.appendChild(m),n.appendChild(l);let p=$create.elem("div","","comp");p.dataset.num=e.meta.num,m.dataset.num=e.meta.num;let c=$create.elem("div","","comp__header"),r=$create.elem("div","","comp__games"),o=$create.elem("h2",`<span>Конкурс №${e.meta.num}</span>`,"comp__header--title");if(e.site&&""!=e.site){let t=$create.link(e.site,$create.db.icon("home"),"",["e"]);t.setAttribute("title","Сайт конкурса"),o.appendChild(t)}if(s){let t=$create.elem("small",`${e.meta.edition} Edition`);o.appendChild(t)}if(c.appendChild(o),e.themes&&0!=e.themes.length){let t=$create.elem("ul","","comp__header--themes");e.themes.forEach(e=>{let a=$create.elem("li");a.appendChild($create.elem("p",`${$create.db.icon("label")}<span>${e.name}</span>`,"_middle")),e.description&&a.appendChild($create.elem("p",$create.db.textBlocks(e.description))),t.appendChild(a)}),c.appendChild(t)}if(e.note&&""!=e.note){let t=$create.elem("div",$create.elem("p",`Примечание: ${$create.db.textBlocks(e.note)}`,"",["html"]),"comp__header--note");c.appendChild(t)}if(e.achievements&&""!=e.achievements){let t=$create.elem("details","","comp__header--ach"),a=$create.elem("ul");t.appendChild($create.elem("summary","","btn btn--nfw")),e.achievements.forEach(e=>{let t=$create.elem("li");t.appendChild($create.elem("p",`${$create.db.icon("place")}<span>${e.name}</span>`,"comp__header--ach _middle")),e.description&&""!=e.description&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Описание</b>: ${e.description}`),"comp__header--ach")),e.gift&&""!=e.gift&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Приз</b>: ${e.description}`))),e.win&&""!=e.win&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Победитель</b>: ${e.description}`))),a.appendChild(t)}),t.appendChild(a),c.appendChild(t)}if(e.fund&&""!=e.fund){let t=$create.elem("div",$create.elem("p",`Призовой фонд: ${e.fund}`,"",["html"]),"comp__header--fund");c.appendChild(t)}if(e.dates){let t=$create.elem("div","","comp__header--dates");e.dates.start&&t.appendChild($create.elem("p",`Начало конкурса: ${$create.db.time(e.dates.start)}`)),e.dates.end&&t.appendChild($create.elem("p",`Конец конкурса: ${$create.db.time(e.dates.end)}`)),c.appendChild(t)}p.appendChild(c),e.games&&0!=e.games.length&&(e.games.forEach((t,a)=>{"disqualified"==t.status&&(delete e.games[a],e.games.push(t))}),e.games.forEach(e=>{let a=parseGame({game:e,CDN:t});r.appendChild(a)})),p.appendChild(r),i.appendChild(p);let $={num:e.meta.num};if(s){m.dataset.edition=e.meta.edition,p.dataset.edition=e.meta.edition,$.edition=e.meta.edition;let t=$create.elem("p",`${e.meta.edition} Edition`,"btn__comp--edition");m.appendChild(t)}0==a&&sessionStorage.setItem("db_firstCompInFile",JSON.stringify($)),m.addEventListener("click",e=>{d($)})}),a.appendChild(n),d(JSON.parse(sessionStorage.getItem("db_firstCompInFile")))}).catch(e=>{console.log(e)})};document.addEventListener("DOMContentLoaded",()=>{parseLocalComps([{name:"Two Weeks Game",file:"twg"},{name:"Two-Two Weeks Game",file:"ttwg"},{name:"One Week Game",altNames:["Two/Two Weeks Game"],file:"owg"},{name:"Three Days Game",file:"three-dg"},{name:"Two Days Game",file:"two-dg"}]);let e=$check.get("get")||"twg";getCompData(e)});
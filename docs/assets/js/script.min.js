"use strict";$create.db={icon:e=>`<i class="material-icons">${e}</i>`,textBlocks:e=>`<span class="_tb">${e.replace(/\n/g,'</span><span class="_tb">')}</span>`,time:e=>{return new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(1e3*e))}};let parseLocalNames=e=>{let t=$make.qs(".names"),a=$create.elem("ul");e.forEach(e=>{let t=$create.elem("li"),n=$create.elem("button",e.name,"btn btn__name");if(n.dataset.name=e.file,e.altNames&&0!=e.altNames.length){let t=$create.elem("ul","","btn__name--alt-names-list");e.altNames.forEach(e=>{let a=$create.elem("li",e);t.appendChild(a)}),n.appendChild(t)}n.addEventListener("click",t=>{selectName(e.file)}),t.appendChild(n),a.appendChild(t)}),t.appendChild(a)},parseGame=e=>{if(!e)return;let t=e,a=$create.elem("div","","comp_games--game _game");if(t.image&&""!=t.image){let e=$create.elem("picture","","_game__image"),n=$create.elem("img");n.dataset.src=t.image,n.addEventListener("error",n=>{a.classList.add("_game--no-image"),e.remove(),console.warn(`Ошибка загрузки картинки у игры "${t.name}".`)}),e.appendChild(n),a.appendChild(e)}else a.classList.add("_game--no-image");let n=$create.elem("div","","_game__info"),d=$create.elem("h2",$create.db.icon("videogame_asset"),"_game__info--name _middle");d.appendChild($create.elem("span",t.name&&""!=t.name?t.name:"Названия нет")),n.appendChild(d),t.genre&&""!=t.genre&&n.appendChild($create.elem("p",`Жанр: ${t.genre}`)),n.appendChild($create.elem("div",t.description?$create.db.textBlocks(t.description):"Описания нет.","_game__info--description")),t.tools&&""!=t.tools&&n.appendChild($create.elem("p",`Инструменты: ${t.tools}`)),t.dependencies&&""!=t.dependencies&&n.appendChild($create.elem("p",`Зависимости: ${t.dependencies}`)),t.note&&""!=t.note&&n.appendChild($create.elem("p",`Примечание: ${t.note}`));let i="";switch(t.status){case"win":case"1":i="Победитель";break;case"2":case"3":case"4":i=`${t.status} место`;break;case"final":i="Финалист";break;case"demo":i="Демоверсия";break;case"updated":i="Обновлённая версия";break;case"disqualified":i="Дисквалификация";break;default:console.warn(`Неизвестный статус ${t.status} у ${t.name}`)}let l=$create.elem("div",$create.db.icon("disqualified"!=t.status?"star":"close"),`_game__info--status _status _status--${t.status&&""!=t.status?t.status:"empty"}`);if(l.firstChild.setAttribute("title",i),n.appendChild(l),t.links&&0!=Object.keys(t.links)){let e=(e=>{let t=$create.elem("table","","_game__info--links");t.appendChild($create.elem("caption","Ссылки:"));let a=[];return(a=(e=>{let t=[],a=e=>t.push(e),n=["site","store","source","updated","final","dlc","demo_updated","demo","ost"];for(let t of n)t in e&&a({type:t,content:e[t]});return t})(e)).forEach(a=>{let n=$create.elem("tr"),d=(e,t)=>{t||(t="html"),n.innerHTML="html"==t?e:e()},i=(e,t)=>{t||(t="standart");let a="";switch(t){case"store":"steam"in e&&(a+=$create.link(`https://store.steampowered.com/app/${e.steam}`,"Steam","",["e","html"])),"gplay"in e&&(a+=$create.link(`https://play.google.com/store/apps/details?id=${e.gplay}`,"Google Play","",["e","html"])),"itunes"in e&&(a+=$create.link(`https://itunes.apple.com/app/id${e.itunes}`,"App Store","",["e","html"])),"itch"in e&&(a+=$create.link(`https://${e.itch.user}.itch.io/${e.itch.game}`,"itch.io","",["e","html"])),"gamejolt"in e&&(a+=$create.link(`https://gamejolt.com/games/${e.gamejolt}`,"Game Jolt","",["e","html"]));break;case"standart":"yadisk"in e&&(a+=$create.link(`https://yadi.sk/d/${e.yadisk}`,"Яндекс.Диск","",["e","html"])),"gdrive"in e&&(a+=$create.link(`https://drive.google.com/open?id=${e.gdrive}`,"Google Drive","",["e","html"])),"web"in e&&(a+=$create.link(e.web,"Онлайн-версия","",["e","html"]));break;case"source":"repo"in e&&("github"in e.repo&&(a+=$create.link(`https://github.com/${e.repo.github}`,"GitHub","",["e","html"])),"bitbucket"in e.repo&&(a+=$create.link(`https://bitbucket.com/${e.repo.bitbucket}`,"BitBucket","",["e","html"]))),"link"in e&&(a+=$create.link(e.link,"Ссылка","",["e","html"]));break;case"ost":"soundcloud"in e&&(a+=$create.link(`https://soundcloud.com/${e.soundcloud}`,"Ссылка","",["e","html"]))}return a};switch(a.type){case"site":d(`<td>Сайт игры:</td><td>${$create.link(e[a.type],e[a.type],"",["e","html"])}</td>`);break;case"store":d(`<td>Магазины</td><td>${i(a.content,a.type)}</td>`);break;case"updated":d(`<td>Обновлённая финальная версия</td><td>${i(a.content)}</td>`);break;case"final":d(`<td>Финальная версия</td><td>${i(a.content)}</td>`);break;case"dlc":d(`<td>DLC</td><td>${i(a.content)}</td>`);break;case"demo_updated":d(`<td>Обновлённая демоверсия</td><td>${i(a.content)}</td>`);break;case"demo":d(`<td>Демоверсия</td><td>${i(a.content)}</td>`);break;case"source":d(`<td>Исходный код</td><td>${i(a.content,a.type)}</td>`);break;case"ost":d(`<td>Саундтрек</td><td>${i(a.content,a.type)}</td>`)}t.appendChild(n)}),t})(t.links);n.appendChild(e)}return a.appendChild(n),a},getCompData=e=>{e||(e="twg");let t="https://raw.githubusercontent.com/twoweeks/db/master/json/min",a="https://gd-cdn.blyat.science",n=$make.qs(".comps-list"),d=$make.qs(".comps"),i=e=>{[...$make.qsf(".btn__comp",n,["a"]),...$make.qsf(".comp",d,["a"])].forEach(t=>{let n=t.dataset;("selected"in n&&delete n.selected,n.num==e.num&&n.edition==e.edition)&&(n.selected="",t.classList.contains("comp")&&$make.qsf("._game__image > img",t,["a"]).forEach(e=>{let t=e.dataset;t.src&&""!=t.src&&(e.setAttribute("src",`${a}/${t.src}`),delete t.src)}))})};fetch(`${t}/${e}.json`).then(t=>{if(t.ok)return n.textContent="",d.textContent="",t.json();throw`Запрошенного конкурса "${e}" нет в базе данных.`}).then(e=>{let t=$create.elem("ul");e.forEach((e,a)=>{let n=$create.elem("li"),l=$create.elem("button","","btn btn__comp");l.appendChild($create.elem("span",`Конкурс №${e.meta.num}`));let s=!(!e.meta.edition||""==e.meta.edition);n.appendChild(l),t.appendChild(n);let c=$create.elem("div","","comp");c.dataset.num=e.meta.num,l.dataset.num=e.meta.num;let m=$create.elem("div","","comp__header"),r=$create.elem("div","","comp__games"),p=$create.elem("h2",`<span>Конкурс №${e.meta.num}</span>`,"comp__header--title");if(e.site&&""!=e.site){let t=$create.link(e.site,$create.db.icon("home"),"",["e"]);t.setAttribute("title","Сайт конкурса"),p.appendChild(t)}if(s){let t=$create.elem("small",`${e.meta.edition} Edition`);p.appendChild(t)}if(m.appendChild(p),e.themes&&0!=e.themes.length){let t=$create.elem("ul","","comp__header--themes");e.themes.forEach(e=>{let a=$create.elem("li");a.appendChild($create.elem("p",`${$create.db.icon("label")}<span>${e.name}</span>`,"_middle")),e.description&&a.appendChild($create.elem("p",$create.db.textBlocks(e.description))),t.appendChild(a)}),m.appendChild(t)}if(e.note&&""!=e.note){let t=$create.elem("div",$create.elem("p",$create.db.textBlocks(`Примечание: ${e.note}`),"",["html"]),"comp__header--note");m.appendChild(t)}if(e.achievements&&""!=e.achievements){let t=$create.elem("details","","comp__header--ach"),a=$create.elem("ul");t.appendChild($create.elem("summary","","btn btn--nfw")),e.achievements.forEach(e=>{let t=$create.elem("li");t.appendChild($create.elem("p",`${$create.db.icon("place")}<span>${e.name}</span>`,"comp__header--ach _middle")),e.description&&""!=e.description&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Описание</b>: ${e.description}`),"comp__header--ach")),e.gift&&""!=e.gift&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Приз</b>: ${e.gift}`))),e.winner&&""!=e.winner&&t.appendChild($create.elem("p",$create.db.textBlocks(`<b>Победитель</b>: ${e.winner}`))),a.appendChild(t)}),t.appendChild(a),m.appendChild(t)}if(e.fund&&""!=e.fund){let t=$create.elem("div",$create.elem("p",`Призовой фонд: ${e.fund}`,"",["html"]),"comp__header--fund");m.appendChild(t)}if(e.dates){let t=$create.elem("div","","comp__header--dates");e.dates.start&&t.appendChild($create.elem("p",`Начало конкурса: ${$create.db.time(e.dates.start)}`)),e.dates.end&&t.appendChild($create.elem("p",`Конец конкурса: ${$create.db.time(e.dates.end)}`)),m.appendChild(t)}c.appendChild(m),e.games&&0!=e.games.length&&(e.games.forEach((t,a)=>{"disqualified"==t.status&&(delete e.games[a],e.games.push(t))}),e.games.forEach(e=>{let t=parseGame(e);r.appendChild(t)})),c.appendChild(r),d.appendChild(c);let o={num:e.meta.num};if(s){l.dataset.edition=e.meta.edition,c.dataset.edition=e.meta.edition,o.edition=e.meta.edition;let t=$create.elem("p",`${e.meta.edition} Edition`,"btn__comp--edition");l.appendChild(t)}else l.dataset.edition="_none",c.dataset.edition="_none",o.edition="_none";0==a&&sessionStorage.setItem("db_firstCompInFile",JSON.stringify(o)),l.addEventListener("click",e=>{i(o)})}),n.appendChild(t),i(JSON.parse(sessionStorage.getItem("db_firstCompInFile")))}).catch(e=>{console.warn(e)})},selectName=e=>{let t=$make.qs(".names"),a=$make.qsf(".btn__name",t,["a"]),n=t.dataset;n.selected!=e&&(getCompData(e),a.forEach(t=>{let a=t.dataset;n.selected!=e&&("selected"in a&&delete a.selected,a.name==e&&(a.selected=""))}),n.selected=e)};document.addEventListener("DOMContentLoaded",()=>{["names","comps-list","comps"].reverse().forEach(e=>{let t=document.body;t.insertBefore($create.elem("div","",e),t.firstChild)}),parseLocalNames([{name:"Two Weeks Game",file:"twg"},{name:"Two-Two Weeks Game",file:"ttwg"},{name:"One Week Game",altNames:["Two/Two Weeks Game"],file:"owg"},{name:"Three Days Game",file:"three-dg"},{name:"Two Days Game",file:"two-dg"}]),selectName("twg")});